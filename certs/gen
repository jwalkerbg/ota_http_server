echo "[v3_req]" > server_ext.cnf && \
echo "basicConstraints = CA:FALSE" >> server_ext.cnf && \
echo "keyUsage = digitalSignature, keyEncipherment" >> server_ext.cnf && \
echo "extendedKeyUsage = serverAuth" >> server_ext.cnf && \
echo "subjectAltName = DNS:localhost" >> server_ext.cnf && \
openssl req -x509 -nodes -days 3650 -newkey rsa:4096 -keyout ca_key.pem -out ca_cert.pem -subj "/CN=MyCA" -config "/etc/ssl/openssl.cnf" && \
openssl req -nodes -newkey rsa:4096 -keyout server_key.pem -out server_csr.pem -subj "/CN=localhost" -config "/etc/ssl/openssl.cnf" && \
openssl x509 -req -in server_csr.pem -CA ca_cert.pem -CAkey ca_key.pem -CAcreateserial -out server_cert.pem -days 3650 -sha256 -extfile server_ext.cnf -extensions v3_req
